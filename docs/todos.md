# TODOs

## P0

- [ ] Certificate expiry alerting (step-ca file certs)
  - [ ] Add x509-certificate-exporter to vm_monitoring_agent role
  - [ ] Add cert expiry rules to Grafana alerting (<30% lifetime remaining)
  - [ ] Add cert renewal daemon health rules (systemd unit down)
- [ ] Make host_monitoring_agent role OS-generic (Debian + Amazon Linux)
- [ ] Deploy otel-journal-gatewayd-forwarder for pull-based host log collection
  - [ ] Add journal-gatewayd to host_monitoring_agent role
  - [ ] Deploy forwarder to monitoring stack
  - [ ] Configure sources for all Proxmox hosts + public gateway

## P1

- [ ] Enable Proxmox HA for critical VMs ([exploration](exploration/proxmox-ha.md))
  - [ ] Convert Trinity to local-zfs
  - [ ] Convert Oracle to local-zfs
  - [ ] Convert Niobe to local-zfs
  - [ ] Configure HA resources in Tofu
- [ ] Direct Cloudflare ACME cert for Keycloak (after AdGuard split)
  - [ ] Create Ansible role for certbot + cloudflare plugin
  - [ ] Deploy to Keycloak LXC (auth.shdr.ch)
  - [ ] Configure cert renewal hook (systemd reload)
  - [ ] Remove Caddy proxy route for auth.shdr.ch
  - [ ] Update AdGuard DNS to point directly at Keycloak
- [ ] Enroll Cockpit with step-ca (SSH user cert, auto-renewal)
- [ ] Codify existing Grafana dashboards in Ansible (currently manual: Access Point, Disk Health, DNS, HAProxy, Hosts, IoT, ntfy, Postfix, PBS, Proxmox Cluster, qBittorrent, Reverse Proxy, Synapse, UPS)
- [ ] Integrate SSO (OIDC-native apps)
  - [ ] LiteLLM
  - [ ] Dokploy
  - [ ] Infisical
  - [ ] Element
  - [ ] Affine
  - [ ] N8N
- [ ] Enable SSH certificate auth for GitLab git push
  - [ ] Configure gitlab_sshd to trust step-ca user CA
    - [ ] Copy ssh_user_ca_key.pub to GitLab config
    - [ ] Add gitlab_sshd trusted_cert_file in gitlab.rb.j2
  - [ ] Update gitlab.yml playbook to deploy CA pubkey
  - [ ] Test step ssh login → git push workflow
- [ ] Replace Jellyseer, Sonarr, Radarr with MediaManager

## P2

- [ ] Deploy Kubernetes cluster ([exploration](exploration/kubernetes.md))
  - [x] Provision 3 Talos VMs via Tofu (Trinity, Niobe, Neo)
  - [x] Bootstrap Talos cluster
  - [x] Install Cilium CNI with L2 announcements + LoadBalancer VIP
  - [x] Install Gateway API CRDs + main-gateway
  - [x] Install Ceph CSI for persistent storage
  - [x] Install Knative Serving (scale-to-zero)
  - [ ] Install Knative Eventing
  - [x] Install Crossplane + Ceph RGW/Keycloak providers
  - [ ] Install OPA Gatekeeper (policy enforcement)
  - [ ] Install Secrets Store CSI + Vault provider
  - [ ] Install cert-manager + step-ca ClusterIssuer
  - [ ] Install External Secrets Operator
  - [x] Deploy OTEL Collectors (DaemonSet + Deployment) → Monitoring Stack
  - [x] Enable Hubble UI via Gateway API
  - [x] Deploy Headlamp dashboard with Keycloak OIDC
  - [x] Register GitLab Agent
  - [ ] Create k8s dashboards in Grafana
  - [ ] Migrate AI Tool Stack, Messaging Stack to Knative
  - [ ] Migrate Media Stack (rffmpeg → GPU Workstation for transcoding)
  - [ ] Migrate Dokku/Dokploy apps to Knative Services
  - [ ] Configure multi-tenancy (namespaces, quotas, Cilium NetworkPolicies)
- [ ] Deploy patch management stack ([exploration](exploration/patch-management.md))
  - [ ] Deploy WUD for container update visibility
  - [ ] Deploy Trivy for CVE scanning
  - [ ] Deploy Ansible Semaphore for controlled deployment
  - [ ] Create Grafana dashboard for unified view
- [ ] Deploy Fleet/osquery for host visibility ([exploration](exploration/osquery.md))
  - [ ] Deploy Fleet server on Monitoring Stack
  - [ ] Add osquery agent to vm_monitoring_agent role
  - [ ] Configure scheduled queries and policies
- [ ] Complete Tailscale integration ([exploration](exploration/full-tailscale-integration.md))
  - [ ] Phase 2: Gateway credential security (WIF)
  - [ ] Phase 3: VyOS route for home → Tailnet
  - [ ] Phase 4: MagicDNS via AdGuard
- [x] Deploy IDS stack as NixOS VM ([exploration](exploration/network-security.md))
  - [x] Create NixOS config (`nix/hosts/oracle/ids-stack.nix`)
  - [x] Provision VM on Oracle via Tofu
  - [x] Deploy via nixos-rebuild --target-host
  - [x] Configure VyOS port mirror to span port
  - [x] Deploy Zeek for network traffic analysis (quadlet-nix)
  - [x] Deploy Suricata on VyOS router directly
  - [ ] Deploy Nuclei for vulnerability scanning
  - [ ] Add Wazuh agents to vm_monitoring_agent role
- [ ] Consolidate ProtonVPN infrastructure
  - [ ] Unify secrets under `secrets.protonvpn.*` (move qbittorrent VPN creds)
  - [ ] Switch qBittorrent from Gluetun to tun2socks → rotating-proxy
  - [ ] Configure SearXNG to use rotating-proxy SOCKS5
  - [ ] Configure Firecrawl to use rotating-proxy SOCKS5
  - [ ] Configure Prowlarr to use rotating-proxy SOCKS5
- [ ] Create disaster recovery runbook (ZFS rollback, PBS restore, S3 recovery procedures)
- [ ] Integrate SSO (reverse proxy / quirky auth)
  - [ ] Home Assistant
  - [ ] qBittorrent
  - [ ] SABnzbd
  - [ ] Prowlarr
  - [ ] Homarr
- [ ] Deploy rffmpeg server on GPU Workstation (Jellyfin remote transcoding)
- [ ] Add TTS/STT inference to GPU Workstation
- [ ] Integrate Matter/Thread border router into IoT stack
- [ ] Deploy wasmCloud LXC

## P3

- [ ] Continue NixOS migration ([docs](../nixos.md), [exploration](exploration/nixos.md))
  - [x] Dev shell (`nix develop`) - replaced Docker toolbox
  - [x] AdGuard LXC - DNS, OTEL, Prometheus exporter
  - [x] IDS Stack VM - Zeek via quadlet-nix
  - [x] Blockchain Stack VM - bitcoind, monerod, Fulcrum (quadlet)
  - [ ] Migrate Gateway Stack (Caddy, Tailscale, HAProxy)
  - [ ] Migrate Oracle identity stack (Keycloak, step-ca, OpenBao) via nixos-generators LXC
  - [ ] Migrate Monitoring Stack
  - [ ] Migrate Dev Workstation
  - [ ] Migrate IoT Stack
  - [ ] Deploy Desktop VM on Trinity ([exploration](exploration/desktop-vm.md))
    - [ ] Configure iGPU passthrough (freed from Media Stack)
    - [ ] NixOS with KDE/GNOME/Hyprland configs
    - [ ] Sunshine for streaming
    - [ ] Distrobox for multi-distro dev
- [ ] Move dev workstation to Neo
- [ ] Refactor public gateway as "Soren"
  - [ ] Rename to Soren in docs, Ansible, Tailscale
  - [ ] Upgrade Lightsail instance to micro ($5/mo)
  - [ ] Add Uptime Kuma for external monitoring
- [ ] Move Tofu state to Ceph RGW
