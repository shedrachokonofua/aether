- hosts: home-gateway-stack
  gather_facts: true
  roles:
    - common
    - vm_baseline
    - dnf
    - role: vm_monitoring_agent
      prometheus_scrape_configs:
        - job_name: "caddy"
          scrape_interval: 15s
          static_configs:
            - targets: ["localhost:2019"]
        - job_name: "adguard"
          scrape_interval: 15s
          static_configs:
            - targets: ["localhost:9618"]
        - job_name: "unifi"
          scrape_interval: 30s
          static_configs:
            - targets: ["localhost:9130"]
        - job_name: "rotating-proxy"
          scrape_interval: 15s
          static_configs:
            - targets: ["localhost:8404"]

- name: Deploy adguard pod
  import_playbook: adguard/site.yml

- name: Deploy unifi pod
  import_playbook: unifi/site.yml

- name: Deploy caddy pod
  import_playbook: caddy/site.yml

- name: Deploy tailscale pod
  import_playbook: tailscale/site.yml

- name: Deploy rotating-proxy pod
  import_playbook: rotating-proxy/site.yml
